#!/usr/bin/env bash

cd "$(dirname "$0")/../"

LIBS=". $(ls -d node_modules/\@fn2/*)"

for LIB in $LIBS; do
  mkdir -p dist/upload
  cp $LIB/dist/mjs/*.mjs dist/upload

  MJSS="$(ls -d dist/upload/*.mjs)"

  for MJS in $MJSS; do
    npx terser $MJS --compress -m -o $MJS
  done
done

aws s3 cp \
  dist/upload \
  s3://micro-app \
  --acl public-read-write \
  --content-type text/javascript \
  --recursive \
  --include "*.mjs"
